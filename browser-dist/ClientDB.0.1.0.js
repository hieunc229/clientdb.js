!function(){var e={};Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(e){let t,r=[];return Object.keys(e).forEach(n=>{switch(typeof(t=e[n])){case"string":case"number":case"boolean":r.push({property:n,eq:t});break;case"object":Array.isArray(t)?r.push({property:n,range:{from:t[0],to:t[1]}}):r.push(Object.assign({property:n},t));break;default:throw Error(`Unable to parse query "${t}"`)}}),r};var t={},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(e);t.default=class{constructor(e){this.m_max=-1,this.m_page=-1,this.orders=[],this.openDB=e.openDB,this.queries=n.default(e.queries),this.collection=e.collection}_openCursor(e,t,r){return new Promise((n,s)=>{let o=t.index(e).openCursor(r);o.onsuccess=(e=>n(e.target.result)),o.onerror=(e=>s(e))})}_openCursorMultipleRange(e,t,r,n){return new Promise(function(s,o){var i=[],a=0,c=r.length;r.forEach(r=>{let o=t.index(e).openCursor(r);o.onsuccess=(e=>(function(e){a===c&&s(i),i=n(i,e)})(e.target.result)),o.onerror=(e=>(function(e){console.error(e)})(e))})})}sort(){return this.orders=Array.prototype.slice.call(arguments),this}max(e){return this.m_max=e,this}paging(e,t){return this.m_page=e,this.m_max=t,this}run(){let e=this;return new Promise((t,r)=>{let n=0,s=e.queries.length,o=[],i=[];this.openDB(r=>{let a=r.transaction(e.collection,"readonly").objectStore(e.collection);e.queries.forEach(r=>{var c;if(r.eq)c=IDBKeyRange.only(r.eq);else if(r.range)c=IDBKeyRange.bound(r.range.from,r.range.to);else if(r.gt)c=IDBKeyRange.upperBound(r.gt,!1);else if(r.gte)c=IDBKeyRange.upperBound(r.gt,!0);else if(r.lt)c=IDBKeyRange.lowerBound(r.lt,!1);else{if(!r.lte)throw Error(`Unable to parse ${r}`);c=IDBKeyRange.lowerBound(r.lte,!0)}e._openCursor(r.property,a,c).then(e=>(function(e){var r,a,c;Array.isArray(e)?o=o.concat(e):o.push(e),++n===s&&(r=new Array(o.length),a=new Array(o.length),c=0,o.forEach(e=>{-1==r.indexOf(e._id)&&(a[c]=e,r[c++]=e.key)}),a.splice(c),t({items:a,errors:i}))})(e.value)).catch(e=>{!function(e){n++,i.push(e)}({property:r.property,message:e.message})})})})})}};var s={};Object.defineProperty(s,"__esModule",{value:!0}),s.default=class{constructor(){this.events={change:[]},this.triggerOnChangeEvent=(e=>{this.events.change.forEach(t=>{t.callback(e)})})}getEvents(){return this.events}subscribe(e,t,r=!1){if(this.events[e]||(this.events[e]=[]),r){const r=this.events.find(e=>e.id===t.id);-1!==r&&this.events[e].splice(r,1)}this.events[e].push(t)}fire(e,t){const r=this.events[e];r&&r.length&&r.forEach(e=>{e.callback&&e.callback({changed:t})}),this.triggerOnChangeEvent({event:e,changed:t})}onChange(e){this.events.change.push(e)}};var o={},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(o,"__esModule",{value:!0});const a=i(s),c=i(t);o.default=class{constructor(e,t){this.openDB=t,this.ref=e,this.eventManager=new a.default}insert(e){let t=Array.isArray(e)?e:[e];var r=this;return new Promise((e,n)=>{r.openDB(s=>{let o=s.transaction([r.ref],"readwrite"),i=o.objectStore(r.ref);t.forEach(e=>{i.add(e)}),o.oncomplete=(r=>{e({items:t,changes:{inserted:t.length,updated:0,removed:0,unchange:0}})}),o.onerror=(e=>n({items:t,message:e.message}))})})}remove(e){let t=Array.isArray(e)?e:[e],r=this;return new Promise((e,n)=>{r.openDB(s=>{let o,i=s.transaction([r.ref],"readwrite"),a=i.objectStore(r.ref);t.forEach(e=>{if(!(o="string"==typeof e?e:"object"==typeof e&&"_id"in e&&e._id))throw Error(`Unable to delete ${e}`);a.delete(o)}),i.oncomplete=(t=>e(t)),i.onerror=(e=>n(e))})})}update(e,t){let r=this;return new Promise((n,s)=>{r.openDB(o=>{let i=o.transaction([r.ref],"readwrite").objectStore(r.ref),a=i.get(e);a.onsuccess=function(r){var o=r.target.result;if(o){Object.assign(o,t);var a=i.put(o);a.onerror=(e=>s(e)),a.onsuccess=(e=>n(e))}else s({message:`Record "${e}" not existed`})},a.onerror=(e=>s(e))})})}openCursor(e){this.openDB(t=>{t.transaction(this.ref,"readonly").objectStore(this.ref).openCursor().onsuccess=(t=>{e(t.target.result)})})}filter(e){return new c.default({queries:e,openDB:this.openDB.bind(this),collection:this.ref})}};var l={},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(l,"__esModule",{value:!0});const h=u(o),d="__clientdb_default";l.default=class{constructor(e){this.stores=[];var t=d,r=1,n=this._handleOpenFail.bind(this),s=this._handleOpenSuccess.bind(this);e&&(e.name&&(t=e.name),e.version&&(r=e.version),e.onerror&&(n=e.onerror),e.onsuccess&&(s=e.onsuccess)),this.options={name:t,version:r,onerror:n,onsuccess:s,stores:e.stores},this._init()}_handleOpenFail(e){console.error(e.errorCode,"Unable to open database")}_handleOpenSuccess(e){this.db=e.target.result}_handleStructureInitiate(e){if(e.target){var t=e.target.result;this.options.stores&&this.options.stores.forEach(r=>{let n;n=t.objectStoreNames.contains(r.name)?e.target.transaction.objectStore(r.name):t.createObjectStore(r.name,{keyPath:"_id"}),Object.keys(r.keys).forEach(e=>{n.indexNames.contains(e)||n.createIndex(e,e,{unique:r.keys[e]})})})}}_init(){let{name:e,version:t,onerror:r,stores:n}=this.options;var s=indexedDB.open(e||d,t);return r&&(s.onerror=r),s.onsuccess=this._handleOpenSuccess.bind(this),n&&(s.onupgradeneeded=this._handleStructureInitiate.bind(this)),this}open(e){let{name:t,version:r,onerror:n}=this.options;var s=indexedDB.open(t||d,r);n&&(s.onerror=n),s.onsuccess=(t=>{e(s.result)}),this.ref=s}collect(e){return new h.default(e,this.open.bind(this))}destroy(){indexedDB.deleteDatabase(this.options.name||d)}};var p={},f=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(p,"__esModule",{value:!0});const g=f(l);p.default=g.default;var _=p.default;window.ClientDB=_}();